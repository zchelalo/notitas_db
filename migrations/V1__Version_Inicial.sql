CREATE TABLE "tipos_usuario" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "clave" varchar(255) NOT NULL UNIQUE,
  "created_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP),
  "updated_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP)
);

CREATE TABLE "usuarios" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "nombre" varchar(255) NOT NULL,
  "profile_pic" varchar(255),
  "correo" varchar(255) UNIQUE NOT NULL,
  "password" varchar(255) NOT NULL,
  "recovery_token" text,
  "tipo_usuario_id" INT NOT NULL,
  "disabled" BOOLEAN NOT NULL DEFAULT FALSE,
  "created_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP),
  "updated_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP),
  FOREIGN KEY("tipo_usuario_id") REFERENCES "tipos_usuario"("id") ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE "grupos" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "nombre" varchar(255) NOT NULL,
  "descripcion" text,
  "profile_pic" varchar(255),
  "banner" varchar(255),
  "color" varchar(50),
  "disabled" BOOLEAN NOT NULL DEFAULT FALSE,
  "created_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP),
  "updated_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP)
);

CREATE TABLE "roles_grupo" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "clave" varchar(255) NOT NULL,
  "descripcion" text NOT NULL,
  "created_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP),
  "updated_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP)
);

CREATE TABLE "miembros_grupo" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "usuario_id" INT NOT NULL,
  "grupo_id" INT NOT NULL,
  "rol_grupo_id" INT NOT NULL,
  "disabled" BOOLEAN NOT NULL DEFAULT FALSE,
  "created_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP),
  "updated_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP),
  FOREIGN KEY("usuario_id") REFERENCES "usuarios"("id") ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY("grupo_id") REFERENCES "grupos"("id") ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY("rol_grupo_id") REFERENCES "roles_grupo"("id") ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE "notas" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "titulo" varchar(255),
  "nota" text NOT NULL,
  "color" varchar(50),
  "privada" BOOLEAN NOT NULL DEFAULT FALSE,
  "disabled" BOOLEAN NOT NULL DEFAULT FALSE,
  "created_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP),
  "updated_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP)
);

CREATE TABLE "notas_usuario" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "nota_id" INT NOT NULL,
  "usuario_id" INT NOT NULL,
  "disabled" BOOLEAN NOT NULL DEFAULT FALSE,
  "created_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP),
  "updated_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP),
  FOREIGN KEY("nota_id") REFERENCES "notas"("id") ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY("usuario_id") REFERENCES "usuarios"("id") ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE "notas_grupo" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "nota_id" INT NOT NULL,
  "grupo_id" INT NOT NULL,
  "disabled" BOOLEAN NOT NULL DEFAULT FALSE,
  "created_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP),
  "updated_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP),
  FOREIGN KEY("nota_id") REFERENCES "notas"("id") ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY("grupo_id") REFERENCES "grupos"("id") ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE "repeticiones" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "clave" varchar(255) NOT NULL,
  "created_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP),
  "updated_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP)
);

CREATE TABLE "recordatorios" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "fecha" TIMESTAMPTZ NOT NULL,
  "repeticion_id" INT,
  "nota_id" INT NOT NULL,
  "disabled" BOOLEAN NOT NULL DEFAULT FALSE,
  "created_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP),
  "updated_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP),
  FOREIGN KEY("repeticion_id") REFERENCES "repeticiones"("id") ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY("nota_id") REFERENCES "notas"("id") ON UPDATE CASCADE ON DELETE CASCADE
);